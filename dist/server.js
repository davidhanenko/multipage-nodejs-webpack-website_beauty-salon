!function(e){var r={};function i(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=r,i.d=function(e,r,t){i.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,r){if(1&r&&(e=i(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var s in e)i.d(t,s,function(r){return e[r]}.bind(null,s));return t},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="/",i(i.s=24)}([function(e,r){e.exports=require("express")},function(e,r){e.exports=e=>(r,i,t)=>{e(r,i,t).catch(t)}},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("express-validator")},function(e,r,i){var{createLogger:t,format:s,transports:n}=i(36);i(37);var a=i(2).connection,o=t({level:"info",format:s.combine(s.timestamp(),s.colorize(),s.json()),transports:[new n.MongoDB({db:a,tryReconnect:!0,level:"error",collection:"error-logs"}),new n.MongoDB({db:a,tryReconnect:!0,level:"warn",collection:"warn-logs"}),new n.File({filename:"combined.log"})]});o.add(new n.Console({format:s.simple()})),e.exports=o},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(38);i(39);function a(e){return new Promise((r,i)=>{n.get("http://localhost:8000/public/views/".concat(e)).then(e=>{r(e.data)}).catch(i)})}function o(){return(o=s((function*(e,r,i){r=r.indexOf(".ejs")>-1?r.split(".ejs")[0]:r;try{return e.render(r,i),Promise.resolve()}catch(e){return Promise.reject(e)}}))).apply(this,arguments)}e.exports={getTemplateString:a,renderEJS:function(e,r,i){return o.apply(this,arguments)}}},function(e,r){e.exports.isLoggedIn=(e,r,i)=>{if(!e.isAuthenticated())return e.flash("error","Sign in first!"),r.redirect("/admin/login");i()}},function(e,r,i){var t=i(2),s=t.Schema,n=new s({template:String,title:String,descriptionMain:String,description1:String,description2:String,description3:String,description4:String,imageMain:{url:String,id:String},image1:{url:String,id:String},image2:{url:String,id:String},image3:{url:String,id:String},image4:{url:String,id:String},video:{url:String,id:String},imageBeforeAfter:[{type:s.Types.ObjectId,ref:"ImageBeforeAfter"}]});e.exports=t.model("Service",n)},function(e,r,i){var t=i(2),s=t.Schema,n=new s({serviceTitle:String,singleTreatment:String,multiTreatments:String,unitPrice:[{type:s.Types.ObjectId,ref:"Unit"}]});e.exports=t.model("Price",n)},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(7),a=i(8),o=i(11),c=i(14),l=i(15),{renderEJS:d}=i(5),u=i(50),{validationResult:m,matchedData:p}=i(3),f=i(4);e.exports.index=function(){var e=s((function*(e,r){e.logout();var i=yield n.find({}),t=yield a.find({}).populate("unitPrice"),s=yield o.find({}),c=(yield e.session.errors)||{},l=(yield e.session.data)||{};yield d(r,"index",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,page:"home",title:"Ilona",data:l,errors:c,services:i,prices:t,contacts:s})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.about=function(){var e=s((function*(e,r){var i=yield c.findOne({}),t=yield n.find({},"title template"),s=yield o.find({});e.logout(),yield d(r,"about",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,title:"About",page:"about",about:i,services:t,contacts:s})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.email=function(){var e=s((function*(e,r){e.session.cookie.maxAge=3e5;var i=m(e);if(i.isEmpty())try{var t=p(e),{name:s,phone:n,email:a,message:o}=t,c=u.createTransport({host:"smtp.mailtrap.io",port:2525,auth:{user:process.env.MAIL_USER,pass:process.env.MAIL_PASS}}),l={from:a,to:process.env.MAIL_TO,subject:"Email from ...",html:"<h2>".concat(s,"</h2><h3>").concat(n,"</h3><p>").concat(o,"</p>")};c.sendMail(l,(function(r){r&&(e.flash("error","Error, please try again"),f.error(r))})),e.flash("success","Thanks for the message! We‘ll be in touch"),e.session.data=null,e.session.errors=null,r.redirect("/")}catch(r){f.error("From nodemail:"+r.message),e.flash("error",r.message),f.error(r)}else e.session.errors=i.mapped(),e.session.data=e.body,e.flash("error","Please check information and message you entered"),r.redirect("/#contact-form")}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.emailCancel=function(){var e=s((function*(e,r){e.session.destroy(),r.redirect("/")}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.gallery=function(){var e=s((function*(e,r){var i=yield n.find({},"title template"),t=yield l.find({});e.logout(),yield d(r,"gallery",{services:i,gallery:t,page:"gallery",title:"Gallery",cspNonce:r.locals.cspNonce})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.services=function(){var e=s((function*(e,r){e.logout();var i=yield n.findOne({template:e.params.template}).populate("imageBeforeAfter"),t=yield n.find({}),s=yield a.find({}).populate("unitPrice");yield d(r,"our_services/".concat(i.template),{title:i.title,page:i.title,cspNonce:r.locals.cspNonce,service:i,services:t,prices:s})}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r){e.exports=require("path")},function(e,r,i){var t=i(2),s=new(0,t.Schema)({address1stLine:String,address2ndLine:String,telephone:String,email:String,day:String,dayFrom:String,dayTo:String,hoursFrom:String,minsFrom:String,hoursTo:String,minsTo:String,ampmFrom:String,ampmTo:String});e.exports=t.model("Contact",s)},function(e,r,i){var t=i(60),s=t.diskStorage({filename:(e,r,i)=>{i(null,Date.now()+r.originalname)}});r.upload=t({storage:s,fileFilter:(e,r,i)=>{if(!r.originalname.match(/\.(jpg|jpeg|png|gif|heic|mp4)$/i))return i(new Error("Only image files(.jpg, .jpeg, .heic) and video files(.mp4) are allowed!"),!1);i(null,!0)}})},function(e,r){e.exports=require("webpack")},function(e,r,i){var t=i(2),s=new t.Schema({ourMission:String,about:String,aboutSection1:String,aboutSection2:String,aboutSection3:String,image:{url:String,id:String}});e.exports=t.model("About",s)},function(e,r,i){var t=i(2),s=new(0,t.Schema)({galleryImage:{url:String,id:String}});e.exports=t.model("Gallery",s)},function(e,r,i){i(19).config();var t=i(62);t.config({cloud_name:process.env.CLOUDINARY_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET}),e.exports={cloudinary:t,uploads:function(e,r){return new Promise(i=>{t.uploader.upload(e,e=>{i({url:e.secure_url,id:e.public_id,bytes:e.bytes})},r)})}}},function(e,r){e.exports=require("passport")},function(e,r,i){var t=i(2),s=i(40),n=new t.Schema({username:String,permission:String});n.plugin(s),e.exports=t.model("Admin",n)},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=require("rate-limiter-flexible")},function(e,r){e.exports=require("bcryptjs")},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(8),a=i(7),o=i(57),{renderEJS:c}=i(5),{validationResult:l,matchedData:d}=i(3),u=i(4);e.exports.showAddNewPrice=function(){var e=s((function*(e,r){var i=yield a.find({},"title template"),t=yield n.find({},"serviceTitle"),s=(yield e.session.data)||{};yield c(r,"admin/prices/price-new",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,title:"New-price",services:i,prices:t,data:s,page:"add new price"})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.addNewPrice=function(){var e=s((function*(e,r){e.session.cookie.maxAge=3e5;var i=l(e);if(e.session.data=e.body,i.isEmpty())try{var t=d(e);yield n.create(t),e.flash("success","New price added!"),e.session.data=null,r.redirect("/admin")}catch(i){u.error("From admin/prices page:"+i.message),e.flash("error",i.message),r.redirect("back")}else i=i.array({onlyFirstError:!0}),u.info("From admin/prices page:"+i[0].message),e.flash("error",i[0].msg),r.redirect("/admin/prices/price-new")}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.showPrices=function(){var e=s((function*(e,r){var i=yield a.find({},"title template"),t=yield n.find({},"serviceTitle"),s=yield(yield n.findById(e.params.id)).populate("unitPrice").execPopulate(),o=(yield e.session.data)||{};yield c(r,"admin/prices/prices",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,title:s.serviceTitle,page:s.serviceTitle,servicePrice:s,prices:t,services:i,data:o})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.editPriceBlock=function(){var e=s((function*(e,r){var i=l(e);if(i.isEmpty()){var{serviceTitle:t,singleTreatment:s,multiTreatments:a}=e.body;try{var o={serviceTitle:t,singleTreatment:s,multiTreatments:a};yield n.findByIdAndUpdate(e.params.price_id,o),e.flash("success","Price updated"),r.redirect("/admin/prices/".concat(e.params.price_id))}catch(r){u.error("From admin/prices page:"+r.message),e.flash("error",r.message)}}else i=i.array({onlyFirstError:!0}),e.flash("error",i[0].msg),r.redirect("/admin/prices/".concat(e.params.price_id))}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deletePriceBlock=function(){var e=s((function*(e,r){try{yield n.findByIdAndRemove(e.params.price_id),e.flash("success","Price deleted!"),r.redirect("back")}catch(r){u.error("From admin/pricespage:"+r.message),e.flash("error",r.message)}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.addNewUnitPrice=function(){var e=s((function*(e,r){var i=yield n.findById(e.params.id);e.session.cookie.maxAge=3e5;var t=l(e);if(e.session.data=e.body,t.isEmpty())try{var s=d(e),a=yield o.create(s);a.save(),i.unitPrice.push(a),i.save(),e.flash("success","Price added"),e.session.data=null,r.redirect("/admin/prices/"+i._id)}catch(i){u.error("From admin/pricespage:"+i.message),e.flash("error",i.message),r.redirect("back")}else t=t.array({onlyFirstError:!0}),u.debug("From admin/pricespage:"+t[0].msg),e.flash("error",t[0].msg),r.redirect("/admin/prices/"+i._id)}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.editUnitPrice=function(){var e=s((function*(e,r){var{unitTitle:i,singlePrice:t,multiPrice:s}=e.body,n=l(e);n.isEmpty()||(n=n.array({onlyFirstError:!0}),u.debug("From admin/pricespage:"+n[0].msg),e.flash("error",n[0].msg),r.redirect("/admin/prices/".concat(e.params.id)));try{var a={unitTitle:i,singlePrice:t,multiPrice:s};yield o.findByIdAndUpdate(e.params.unit_id,a),e.flash("success","Price updated"),r.redirect("/admin/prices/".concat(e.params.id))}catch(i){u.error("From admin/pricespage:"+i.message),e.flash("error",i.message),r.redirect("/admin/prices/".concat(e.params.id))}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deleteUnitPrice=function(){var e=s((function*(e,r){try{var i=yield n.findById(e.params.id),t=yield o.findByIdAndRemove(e.params.unit_id);i.unitPrice.pull({_id:t._id}),i.save(),e.flash("success","Price deleted!"),r.redirect("back")}catch(i){u.error("From admin/pricespage:"+i.message),e.flash("error",i.message),r.redirect("/admin/prices/".concat(e.params.id))}}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(21),a=i(7),o=i(8),c=i(61),l=i(16),{renderEJS:d}=i(5),{validationResult:u}=i(3),m=i(4);e.exports.showNewService=function(){var e=s((function*(e,r){var i=yield a.find({},"title template"),t=yield o.find({},"serviceTitle");yield d(r,"admin/our_services/service-new",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,services:i,prices:t,page:"underfined",title:"New-service"})}));return function(r,i){return e.apply(this,arguments)}}();var p={transformation:[{width:550,height:550,crop:"fill"},{width:"auto",dpr:"auto",crop:"scale"}],fetch_format:"auto",quality:85,resource_type:"auto",folder:"Ilona"},f={transformation:[{width:450,crop:"fill"},{width:"auto",dpr:"auto",crop:"scale"}],quality:100,fetch_format:"auto",resource_type:"auto",folder:"Ilona"},g={resource_type:"auto",chunk_size:6e6,folder:"Ilona/Video",eager:[{width:300,height:300,crop:"pad",audio_codec:"none"},{width:160,height:100,crop:"crop",gravity:"south",audio_codec:"none"}],eager_async:!0};e.exports.createService=function(){var e=s((function*(e,r){var i=u(e);i.isEmpty()||(i=i.array({onlyFirstError:!0}),e.flash("error",i[0].msg),r.redirect("back"));try{var{template:t,title:n,descriptionMain:o,description1:c,description2:d,description3:v,description4:y}=e.body,h=function(){var e=s((function*(e,r){return yield l.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}(),w=null,b=null,x=null,j=null,k=null,_=null;e.files.imageMain?e.files.imageMain[0].size<1e7?w=yield h(e.files.imageMain[0].path,p):e.flash("error","Please review size of images. 10Mb is maximum allowed"):e.flash("error","Main image for service is required"),e.files.image1&&e.files.image1[0].size<1e7?b=yield h(e.files.image1[0].path,f):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image2&&e.files.image2[0].size<1e7?x=yield h(e.files.image2[0].path,f):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image3&&e.files.image3[0].size<1e7?j=yield h(e.files.image3[0].path,f):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image4&&e.files.image4[0].size<1e7?k=yield h(e.files.image4[0].path,f):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.video&&e.files.video[0].size<1e8?_=yield h(e.files.video[0].path,g):e.flash("error","Please review size of video. 100Mb is maximum allowed");var S={template:t,title:n,descriptionMain:o,description1:c,description2:d,description3:v,description4:y,imageMain:w,image1:b,image2:x,image3:j,image4:k,video:_};yield a.create(S),e.flash("success","New service added!"),r.redirect("/admin")}catch(i){m.error("From Services:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.showService=function(){var e=s((function*(e,r){var i=yield a.find({},"title template"),t=yield o.find({},"serviceTitle"),s=yield(yield a.findOne({title:e.params.title})).populate("imageBeforeAfter").execPopulate();yield d(r,"admin/our_services/".concat(s.template),{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,service:s,services:i,prices:t,title:s.title,page:s.title})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.updateService=function(){var e=s((function*(e,r){var i=yield a.findOne({title:e.params.title});try{var t=function(){var e=s((function*(e,r){return yield l.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}();e.files&&(e.files.imageMain&&e.files.imageMain[0].size<1e7?(i.imageMain.id&&(yield l.cloudinary.uploader.destroy(i.imageMain.id)),i.imageMain=yield t(e.files.imageMain[0].path,p)):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image1&&e.files.image1[0].size<1e7?(i.image1.id&&(yield l.cloudinary.uploader.destroy(i.image1.id)),i.image1=yield t(e.files.image1[0].path,f)):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image2&&e.files.image2[0].size<1e7?(i.image2.id&&(yield l.cloudinary.uploader.destroy(i.image2.id)),i.image2=yield t(e.files.image2[0].path,f)):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image3&&e.files.image3[0].size<1e7?(i.image3.id&&(yield l.cloudinary.uploader.destroy(i.image3.id)),i.image3=yield t(e.files.image3[0].path,f)):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.image4&&e.files.image4[0].size<1e7?(i.image4.id&&(yield l.cloudinary.uploader.destroy(i.image4.id)),i.image4=yield t(e.files.image4[0].path,f)):e.flash("error","Please review size of images. 10Mb is maximum allowed"),e.files.video&&e.files.video[0].size<1e8?(i.video.id&&(yield l.cloudinary.uploader.destroy(i.video.id,{invalidate:!0,resource_type:"video"})),i.video=yield t(e.files.video[0].path,g)):e.flash("error","Please review size of video. 100Mb is maximum allowed"),e.body.deleteVideo&&(yield l.cloudinary.uploader.destroy(i.video.id,{invalidate:!0,resource_type:"video"}),yield i.updateOne({$unset:{video:""}})));var n=u(e);if(n.isEmpty())try{i.title=e.body.title,i.descriptionMain=e.body.descriptionMain,i.description1=e.body.description1,i.description2=e.body.description2,i.description3=e.body.description3,i.description4=e.body.description4,i.save(),e.flash("success","Service information updated"),r.redirect("/admin/services/".concat(i.title))}catch(t){e.flash("error",t.message),r.redirect("/admin/services/".concat(i.title))}else n=n.array({onlyFirstError:!0}),e.flash("error",n[0].msg),r.redirect("/admin/services/".concat(i.title))}catch(t){m.error("From Services:"+t),e.flash("error",t.message),r.redirect("/admin/services/".concat(i.title))}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deleteService=function(){var e=s((function*(e,r){try{(yield n.compare(e.body.permission,e.user.permission))?(yield a.findByIdAndDelete(e.params.id),e.flash("success","Service deleted"),r.redirect("/admin")):(e.flash("error","Wrong permission password! Try again"),r.redirect("back"))}catch(r){m.error("From Services:"+r),e.flash("error",r.message)}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.addNewImageBA=function(){var e=s((function*(e,r){try{var i=yield a.findOne({title:e.params.title}),t=e.body.isCoverEyes,n={transformation:[{width:400,height:400,crop:"fill"}],quality:85,resource_type:"auto",folder:"Ilona/BA"};t&&(n={transformation:[{width:400,height:400,crop:"fill"},{flags:"region_relative",gravity:"adv_eyes",overlay:"rectangle",width:"1.7"}],quality:85,resource_type:"auto",folder:"Ilona/BA"});var o=function(){var e=s((function*(e,r){return yield l.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}();if(e.files.imageBefore&&e.files.imageAfter){var d=yield o(e.files.imageBefore[0].path,n),u=yield o(e.files.imageAfter[0].path,n);if(d.bytes<1e7&&u.bytes<1e7){var p=yield c.create({imageBefore:d,imageAfter:u});p.save(),i.imageBeforeAfter.push(p),i.save(),e.flash("success","Images successefully uploaded!"),r.redirect("/admin/services/".concat(i.title))}else e.flash("error","Please review size of images. 10Mb is maximum size for each image."),r.redirect("back")}else e.flash("error","Please choose TWO images!"),r.redirect("back")}catch(i){m.error("From before-after images:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deleteImageBA=function(){var e=s((function*(e,r){try{var i=yield a.findOne({title:e.params.title}),t=yield c.findByIdAndDelete(e.params.img_id);yield l.cloudinary.uploader.destroy(t.imageBefore.id),yield l.cloudinary.uploader.destroy(t.imageAfter.id),yield i.imageBeforeAfter.pull({_id:t._id}),i.save(),e.flash("success","Image deleted"),r.redirect("back")}catch(i){m.error("From before-after images:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r,i){var t=i(10),s=i(0),n=i(25),a=i(2),o=i(13),c=i(26),l=i(27),d=i(28),u=i(29),m=i(17),p=i(30),f=i(31),g=i(32),v=i(33),y=i(34)(u),h=(i(35),i(4)),{renderEJS:w}=i(5),b=i(18),x=(i(41),i(42),i(43)),j=(o(x),i(49)),k=i(53),_=i(54),S=i(70),P=i(71),T=i(72),N=process.env.DB_URL;a.connect(N,{useNewUrlParser:!0,useCreateIndex:!0,useUnifiedTopology:!0,useFindAndModify:!1});var M=a.connection;M.on("error",h.error.bind(console,"connection error:")),M.once("open",()=>{h.info("Database connected")});var A=s();A.disable("x-powered-by"),A.use(l());var E=new y({url:N,secret:process.env.MONGO_STORE_SEC,touchAfter:86400});E.on("error",(function(e){h.error("Session store error: ".concat(e))})),A.use(u({store:E,name:process.env.SESSION_NAME,secret:process.env.SESSION_SEC,saveUninitialized:!1,resave:!1,unset:"destroy",cookie:{httpOnly:!0,sameSite:!0,maxAge:12e5}})),A.use(c()),A.use(s.urlencoded({extended:!0})),A.use(v("_method")),A.use(d()),A.use(m.initialize()),A.use(m.session()),m.use(new p(b.authenticate())),m.serializeUser(b.serializeUser()),m.deserializeUser(b.deserializeUser()),A.set("view engine","ejs"),A.set("views",t.join(__dirname,"./views")),A.use(s.static(__dirname+"/")),A.use((e,r,i)=>{r.locals.cspNonce=g.randomBytes(64).toString("hex"),i()}),A.use(f({contentSecurityPolicy:{directives:{"default-src":["'self'"],"script-src":["'self'","maps.googleapis.com",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"frame-src":["'self'","www.google.com",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"object-src":["'self'",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"style-src":["'self'","fonts.googleapis.com",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"style-src-elem":["'self'","'unsafe-inline'","fonts.googleapis.com",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"font-src":["'self'","fonts.gstatic.com",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"img-src":["'self' data:","https://res.cloudinary.com/dxxcixosf/","maps.gstatic.com *.googleapis.com *.ggpht",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")],"media-src":["'self' data:","https://res.cloudinary.com/dxxcixosf/",(e,r)=>"'nonce-".concat(r.locals.cspNonce,"'")]}},referrerPolicy:{policy:"strict-origin-when-cross-origin"},featurePolicy:{}})),A.use(n()),A.use((e,r,i)=>{r.locals.admin=e.user,r.locals.error=e.flash("error"),r.locals.success=e.flash("success"),i()}),A.use("/",j),A.use("/services",k),A.use("/admin",_),A.use("/gallery",S),A.use("/about",P),A.use("/errors",T),A.use((function(e,r,i,t){if("EBADCSRFTOKEN"!==e.code)return t(e);r.flash("error","Forbiden, reload the page and try again"),h.warn("403 "+e),i.redirect("back")})),A.use((e,r,i)=>{r.redirect("/errors/404")}),A.use((e,r,i,t)=>{var{statusCode:s=500}=e;e.message||(e.message="Oh No, Something Went Wrong!"),h.error(e.stack.split("\n").slice(0,5).join("\n")),i.status(s).render("errors/errors.ejs",{err:e})});var I=process.env.PORT||8e3;A.listen(I,()=>{h.info("Serving on port ".concat(I))})},function(e,r){e.exports=require("csurf")},function(e,r){e.exports=require("connect-flash")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("express-mongo-sanitize")},function(e,r){e.exports=require("express-session")},function(e,r){e.exports=require("passport-local")},function(e,r){e.exports=require("helmet")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("method-override")},function(e,r){e.exports=require("connect-mongo")},function(e,r){class i extends Error{constructor(e,r){super(),this.message=e,this.statusCode=r}}e.exports=i},function(e,r){e.exports=require("winston")},function(e,r){e.exports=require("winston-mongodb")},function(e,r){e.exports=require("axios")},function(e,r){e.exports=require("ejs")},function(e,r){e.exports=require("passport-local-mongoose")},function(e,r){e.exports=require("webpack-dev-middleware")},function(e,r){e.exports=require("webpack-hot-middleware")},function(e,r,i){var t=i(10),s=i(13),{merge:n}=i(44),a=i(45);e.exports=n(a,{output:{path:t.join(__dirname,"./dist"),publicPath:"/public/",filename:"js/[name].[hash].js"},mode:"development",devtool:"source-map",module:{rules:[{enforce:"pre",test:/\.js$/,exclude:/node_modules/,loader:"eslint-loader",options:{emitWarning:!0,failOnError:!1,failOnWarning:!1}},{test:/\.css$/,use:["style-loader","css-loader"]}]},plugins:[new s.DefinePlugin({"process.env.NODE_ENV":JSON.stringify("development")}),new s.HotModuleReplacementPlugin,new s.NoEmitOnErrorsPlugin]})},function(e,r){e.exports=require("webpack-merge")},function(e,r,i){var{resolve:t,basename:s}=i(10),n=i(10),a=i(13),o=i(46),c=i(47),l=i(48),d=i(19).config({path:n.join(__dirname,".env")});e.exports={entry:{index:"./src/js/index.js",service:"./src/js/service.js",gallery:"./src/js/gallery.js",about:"./src/js/about.js",admin:"./src/js/admin/admin.js",admin_login:"./src/js/admin/login.js",admin_register:"./src/js/admin/register.js",admin_service:"./src/js/admin/services.js",admin_price:"./src/js/admin/prices.js",admin_contacts:"./src/js/admin/contacts.js",admin_about:"./src/js/admin/about.js",admin_gallery:"./src/js/admin/gallery.js",admin_header:"./src/js/admin/header.js",errors:"./src/js/errors/errors.js",404:"./src/js/errors/404.js"},target:"web",devtool:"source-map",module:{rules:[{test:/\.js$/,exclude:/node_modules|lib|libs/,use:{loader:"babel-loader"}},{test:/\.html$/,use:[{loader:"html-loader",options:{attrs:["img:src","img:data-src",":data-background"]}}]},{test:/\.ejs$/,use:[{loader:"html-loader",options:{attrs:["img:src","img:data-src",":data-background"]}},{loader:"ejs-webpack-loader",options:{production:"production"===process.env.ENV}}]},{test:/\.(eot|woff2|woff|ttf|svg)$/,use:[{loader:"file-loader",options:{outputPath:"fonts"}},{loader:"url-loader"}]},{test:/\.(png|jpg|jpeg|gif)$/,use:[{loader:"url-loader",options:{name:"[name].[hash:5].[ext]",limit:1e3,outputPath:"imgs"}},{loader:"image-webpack-loader",options:{disable:!1,pngquant:{quality:[.65,.9]}}}]}]},plugins:[new o({template:"!!ejs-webpack-loader!./src/views/index.ejs",filename:"views/index.ejs",chunks:["index","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/atms.ejs",filename:"views/our_services/atms.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/microdermabrasion.ejs",filename:"views/our_services/microdermabrasion.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/chemical-peel.ejs",filename:"views/our_services/chemical-peel.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/permanent-makeup.ejs",filename:"views/our_services/permanent-makeup.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/ipl-laser.ejs",filename:"views/our_services/ipl-laser.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/our_services/multifunctional-facials.ejs",filename:"views/our_services/multifunctional-facials.ejs",chunks:["service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/gallery.ejs",filename:"views/gallery.ejs",chunks:["gallery","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/about.ejs",filename:"views/about.ejs",chunks:["about","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/prices/price-new.ejs",filename:"views/admin/prices/price-new.ejs",chunks:["admin_price","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/service-new.ejs",filename:"views/admin/our_services/service-new.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/admin.ejs",filename:"views/admin/admin.ejs",chunks:["admin","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/login/login.ejs",filename:"views/admin/login/login.ejs",chunks:["admin_login","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/login/register.ejs",filename:"views/admin/login/register.ejs",chunks:["admin_register","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/service.ejs",filename:"views/admin/our_services/service.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/atms.ejs",filename:"views/admin/our_services/atms.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/microdermabrasion.ejs",filename:"views/admin/our_services/microdermabrasion.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/chemical-peel.ejs",filename:"views/admin/our_services/chemical-peel.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/permanent-makeup.ejs",filename:"views/admin/our_services/permanent-makeup.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/ipl-laser.ejs",filename:"views/admin/our_services/ipl-laser.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/our_services/multifunctional-facials.ejs",filename:"views/admin/our_services/multifunctional-facials.ejs",chunks:["admin_service","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/prices/prices.ejs",filename:"views/admin/prices/prices.ejs",chunks:["admin_price","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/contacts/contacts.ejs",filename:"views/admin/contacts/contacts.ejs",chunks:["admin_contacts","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/gallery/gallery.ejs",filename:"views/admin/gallery/gallery.ejs",chunks:["admin_gallery","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/about/about.ejs",filename:"views/admin/about/about.ejs",chunks:["admin_about","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/admin/partials/header.ejs",filename:"views/admin/partials/header.ejs",chunks:["admin_about","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/errors/404.ejs",filename:"views/errors/404.ejs",chunks:["404","manifest","vendors"]}),new o({template:"!!ejs-webpack-loader!./src/views/errors/errors.ejs",filename:"views/errors/errors.ejs",chunks:["errors","manifest","vendors"]}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"index.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"about.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"atms.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"chemical-peel.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"permanent-makeup.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"mictodermabrasion.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"ipl-laser.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"multifunctional-facials.ejs"===s(e.options.filename)}),new l({logo:"./src/imgs/favicon.png",developerURL:null,inject:e=>"gallery.ejs"===s(e.options.filename)}),new c({patterns:[{from:t(__dirname,"./src/imgs"),to:t(__dirname,"dist/imgs")}]}),new a.ProvidePlugin({$:"jquery",jQuery:"jquery"}),new a.DefinePlugin({"process.env":JSON.stringify(d.parsed)})]}},function(e,r){e.exports=require("html-webpack-plugin")},function(e,r){e.exports=require("copy-webpack-plugin")},function(e,r){e.exports=require("favicons-webpack-plugin")},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(9),a=i(1),o=i(51);s.use("/email",o),s.get("/",a(n.index)),e.exports=s},function(e,r){e.exports=require("nodemailer")},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),{email:n,emailCancel:a}=i(9),o=i(1),{check:c}=i(3),l=i(52);s.post("/",l,[c("name").trim().isLength({min:1}).withMessage("Name is required"),c("phone").if((e,r)=>{var{req:i}=r;return i.body.phone}).escape().isLength({min:10,max:11}).withMessage("Please enter valid phone number"),c("message").trim().escape().isLength({min:10}).withMessage("Please, tell us a little more, message is too short"),c("email").isEmail().withMessage("That email doesn‘t look right").bail().trim().normalizeEmail()],o(n)),s.post("/cancel",o(a)),e.exports=s},function(e,r,i){var{RateLimiterMongo:t}=i(20),s=i(2),n=i(4),a=new t({storeClient:s.connection,points:4,duration:60});e.exports=(e,r,i)=>{a.consume(e.ip).then(()=>{i()}).catch(()=>(n.error("Too Many Requests"),e.flash("error","Too many attempts, plese try in a minute"),r.redirect("back")))}},function(e,r,i){var{Router:t}=i(0),s=t(),n=i(9),a=i(1);s.get("/:template",a(n.services)),e.exports=s},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(55),a=i(1),{isLoggedIn:o}=i(6),{check:c}=i(3),l=i(56),d=i(59),u=i(64),m=i(66),p=i(68);s.use("/prices",l),s.use("/services",d),s.use("/contacts",u),s.use("/gallery",m),s.use("/about",p),s.get("/",o,a(n.main)),s.route("/register").get(n.showRegister).post([c("username").isLength({min:5}).withMessage("Name should be minimun 5 symbols"),c("permission").isLength({min:6}).withMessage("Permission code should be minimun 6 symbols")],a(n.register)),s.route("/login").get(a(n.showLogin)).post(a(n.login)),s.get("/logout",n.logout),e.exports=s},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(21),a=i(17),{RateLimiterMongo:o}=i(20),c=i(2),l=i(7),d=i(14),u=i(15),m=i(8),p=i(11),f=i(18),g=i(4),{renderEJS:v}=i(5),{validationResult:y}=i(3);e.exports.main=function(){var e=s((function*(e,r){var i=yield l.find({}),t=yield u.find({}),s=yield d.findOne({},"image about"),n=yield m.find({}),a=yield p.find({});yield v(r,"admin/admin",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,services:i,gallery:t,about:s,prices:n,contacts:a,page:"admin",title:"Admin"})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.showRegister=(e,r)=>{v(r,"admin/login/register",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,title:"Register"})},e.exports.register=function(){var e=s((function*(e,r){var i=y(e);if(i.isEmpty())try{var{username:t,password:s,permission:a}=e.body,o=new f({username:t}),c=yield n.genSalt(10);o.permission=yield n.hash(a,c),f.register(o,s,i=>{if(i)return e.flash("error",i.message),r.redirect("back");e.flash("success","Welcome, new ADMIN!"),r.redirect("/admin")})}catch(i){g.error("From admin/register page:"+i.message),e.flash("error",i.message),r.redirect("back")}else i=i.array({onlyFirstError:!0}),e.flash("error",i[0].msg),r.redirect("/admin/register")}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.showLogin=function(){var e=s((function*(e,r){var i=yield l.find({}),t=yield m.find({});yield v(r,"admin/login/login",{cspNonce:r.locals.cspNonce,csrfToken:e.csrfToken(),title:"LogIn",page:"login",services:i,prices:t})}));return function(r,i){return e.apply(this,arguments)}}();var h=c.connection,w=new o({storeClient:h,keyPrefix:"login_fail_ip_per_minute",points:3,duration:60,blockDuration:1800}),b=new o({storeClient:h,keyPrefix:"login_fail_ip_per_day",points:20,duration:86400,blockDuration:86400});e.exports.login=function(){var e=s((function*(e,r,i){var t=e.connection.remoteAddress,[n,o]=yield Promise.all([w.get(t),b.get(t)]),c=0;null!==o&&o.consumedPoints>20?c=Math.round(o.msBeforeNext/1e3)||1:null!==n&&n.consumedPoints>3&&(c=Math.round(n.msBeforeNext/1e3)||1),c>0?(r.set("Retry-After",String(c)),e.flash("error","Too many wrong attempts, try again later"),g.error("From admin/signin page: To many request: 429"),r.redirect("back")):a.authenticate("local",function(){var n=s((function*(s,n){if(s)return i(s);if(n)e.logIn(n,(function(t){return t?i(t):(e.flash("success","Welcome back!"),r.redirect("/admin"))}));else try{return yield Promise.all([w.consume(t),b.consume(t)]),e.flash("Error","Wrong user name or password!"),g.warn("Wrong attempts on: admin/login"),r.redirect("/admin/login")}catch(e){if(e instanceof Error)throw e;r.set("Retry-After",String(Math.round(e.msBeforeNext/1e3))||1),g.error("From admin/signin page: Too many requests, 429"),r.redirect("back")}}));return function(e,r){return n.apply(this,arguments)}}())(e,r,i)}));return function(r,i,t){return e.apply(this,arguments)}}(),e.exports.logout=(e,r)=>{e.logOut(),e.flash("success","You are logged out!"),e.session.destroy(),r.redirect("/admin/login")}},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(22),a=i(1),{isLoggedIn:o}=i(6),{check:c}=i(3),l=i(58);s.use("/:id/units",l);var d=[c("serviceTitle").notEmpty().withMessage("Title is required").not().isNumeric().withMessage("Only string accepted for title field").escape().trim(),c("singleTreatment").notEmpty().withMessage("Number of single treatment is required").isNumeric().withMessage("Only numbers accepted for single treatment field").escape().trim(),c("multiTreatments").optional({checkFalsy:!0}).isNumeric().withMessage("Only numbers accepted for multi treatments field").escape().trim()];s.get("/price-new",o,a(n.showAddNewPrice)),s.post("/",d,o,a(n.addNewPrice)),s.get("/:id",o,a(n.showPrices)),s.route("/:price_id").put(d,o,a(n.editPriceBlock)).delete(o,a(n.deletePriceBlock)),e.exports=s},function(e,r,i){var t=i(2),s=new(0,t.Schema)({unitTitle:String,singlePrice:String,multiPrice:String});e.exports=t.model("Unit",s)},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),{addNewUnitPrice:n,editUnitPrice:a,deleteUnitPrice:o}=i(22),{isLoggedIn:c}=i(6),l=i(1),{check:d}=i(3),u=[d("unitTitle").notEmpty().withMessage("Title is required").not().isNumeric().withMessage("Only string accepted for title field").escape().trim(),d("singlePrice").notEmpty().withMessage("Single price is required").isNumeric().withMessage("Only numbers accepted for single price field").escape().trim(),d("multiPrice").optional({checkFalsy:!0}).isNumeric().withMessage("Only numbers accepted for multi price field").escape().trim()];s.post("/",u,c,l(n)),s.route("/:unit_id").put(u,c,l(a)).delete(c,l(o)),e.exports=s},function(e,r,i){var t=i(12),{Router:s}=i(0),n=s({mergeParams:!0}),a=i(23),o=i(1),{isLoggedIn:c}=i(6),{check:l}=i(3),d=i(63);n.use("/:title/imagesb-a",d),n.get("/service-new",c,o(a.showNewService));var u=[{name:"imageMain",maxCount:1},{name:"image1",maxCount:1},{name:"image2",maxCount:1},{name:"image3",maxCount:1},{name:"image4",maxCount:1},{name:"video",maxCount:1}],m=[l("title").isLength({min:3}).withMessage("Title required").escape().trim(),l("descriptionMain").notEmpty().withMessage("Description for main page is required").trim(),l("description1").trim(),l("description2").trim(),l("description3").trim(),l("description4").trim()];n.post("/",[l("template").notEmpty().withMessage("Template required").escape().trim()],c,t.upload.fields(u),m,o(a.createService)),n.route("/:title").get(c,o(a.showService)).put(c,t.upload.fields(u),m,o(a.updateService)),n.delete("/:id",c,o(a.deleteService)),e.exports=n},function(e,r){e.exports=require("multer")},function(e,r,i){var t=i(2),s=new(0,t.Schema)({imageBefore:{url:String,id:String},imageAfter:{url:String,id:String}});e.exports=t.model("ImageBeforeAfter",s)},function(e,r){e.exports=require("cloudinary")},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),{addNewImageBA:n,deleteImageBA:a}=i(23),{isLoggedIn:o}=i(6),c=i(12),l=i(1);s.post("/",o,c.upload.fields([{name:"imageBefore",maxCount:1},{name:"imageAfter",maxCount:1}]),l(n)),s.delete("/:img_id",o,l(a)),e.exports=s},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(65),{isLoggedIn:a}=i(6),o=i(1);s.route("/contacts-edit").get(a,o(n.showContacts)).post(a,o(n.addContacts)),s.route("/:contact_id").put(a,o(n.editContacts)).delete(a,o(n.deleteContact)),e.exports=s},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(11),a=i(8),o=i(7),{renderEJS:c}=i(5),l=i(4);e.exports.showContacts=function(){var e=s((function*(e,r){var i=yield o.find({},"title template"),t=yield a.find({},"serviceTitle"),s=yield n.find({}),l=(yield e.session.data)||{};yield c(r,"admin/contacts/contacts",{cspNonce:r.locals.cspNonce,contacts:s,services:i,prices:t,data:l,title:"contacts-edit",page:"contacts",csrfToken:e.csrfToken()})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.addContacts=function(){var e=s((function*(e,r){try{var{address1stLine:i,address2ndLine:t,telephone:s,email:a,day:o,dayFrom:c,dayTo:d,hoursFrom:u,hoursTo:m,minsFrom:p,minsTo:f,ampmFrom:g,ampmTo:v}=e.body,y={address1stLine:i,address2ndLine:t},h={telephone:s,email:a},w={day:o,dayFrom:c,dayTo:d,hoursFrom:u,hoursTo:m,minsFrom:p,minsTo:f,ampmFrom:g,ampmTo:v};for(var b of Object.values(y))if(""!==b&&void 0!==b)return i?(yield n.create(y),e.flash("success","Contact information added successefull"),r.redirect("/admin/contacts/contacts-edit")):(e.session.data=e.body,e.flash("error","First address line required"),r.redirect("back"));for(var x of Object.values(h))if(""!==x&&void 0!==x)return yield n.create(h),e.flash("success","Contact information added successefull"),r.redirect("/admin/contacts/contacts-edit");for(var j of Object.values(w))if(""!==j&&void 0!==j)return c&&o||d&&o||o&&d&&c||c&&""==d||""==c&&d?(e.session.data=e.body,e.flash("error",'Please choose both "Day from" and "Day to", or only one working day'),r.redirect("back")):(yield n.create(w),e.session.data={},e.flash("success","Contact information added successefull"),r.redirect("/admin/contacts/contacts-edit"));e.flash("error","Nothing was to update"),r.redirect("back")}catch(i){l.error("From admin/contacts page:"+i.message),r.redirect("back"),e.flash("error",i.message)}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.editContacts=function(){var e=s((function*(e,r){try{var{address1stLine:i,address2ndLine:t,telephone:s,email:a,day:o,dayFrom:c,dayTo:d,hoursFrom:u,hoursTo:m,minsFrom:p,minsTo:f,ampmFrom:g,ampmTo:v}=e.body,y={address1stLine:i,address2ndLine:t},h={telephone:s,email:a},w={day:o,dayFrom:c,dayTo:d,hoursFrom:u,hoursTo:m,minsFrom:p,minsTo:f,ampmFrom:g,ampmTo:v};for(var b of Object.values(y))if(""!==b&&void 0!==b)return i?(yield n.findByIdAndUpdate(e.params.contact_id,y),e.flash("success","Contact information updated successefull"),r.redirect("/admin/contacts/contacts-edit")):(e.session.data=e.body,e.flash("error","First address line required"),r.redirect("back"));for(var x of Object.values(h))if(""!==x&&void 0!==x)return yield n.findByIdAndUpdate(e.params.contact_id,h),e.flash("success","Contact information updated successefull"),r.redirect("/admin/contacts/contacts-edit");for(var j of Object.values(w)){if(""!==j&&void 0!==j){if(c&&o||d&&o||o&&d&&c)return e.session.data=e.body,e.flash("error",'Please choose both "Day from" and "Day to", or only one working day'),r.redirect("back");if(c&&""==d||""==c&&d)return e.session.data=e.body,e.flash("error",'Please choose both "Day from" and "Day to", or only one working day'),r.redirect("back")}yield n.findByIdAndUpdate(e.params.contact_id,w)}e.flash("success","Contact information updated successefull"),r.redirect("/admin/contacts/contacts-edit")}catch(i){l.error("From admin/contacts page:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deleteContact=function(){var e=s((function*(e,r){try{yield n.findByIdAndRemove(e.params.contact_id),e.flash("success","Contacts information deleted!"),r.redirect("back")}catch(i){l.error("From admin/contacts page:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(67),{isLoggedIn:a}=i(6),o=i(12),c=i(1);s.route("/").get(a,c(n.showGallery)).post(a,o.upload.fields([{name:"galleryImage",maxCount:3}]),c(n.addNewPhoto)),s.delete("/:img_id",a,c(n.deletePhoto)),e.exports=s},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(15),a=i(7),o=i(8),c=i(16),{renderEJS:l}=i(5),d=i(4);e.exports.showGallery=function(){var e=s((function*(e,r){var i=yield a.find({},"title template"),t=yield o.find({},"serviceTitle"),s=yield n.find({});yield l(r,"admin/gallery/gallery",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,page:"gallery",title:"Gallery",prices:t,services:i,gallery:s})}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.addNewPhoto=function(){var e=s((function*(e,r){try{var i={transformation:[{width:650,height:650,crop:"fill"}],quality:100,resource_type:"auto",folder:"Ilona/Gallery"},t=function(){var e=s((function*(e,r){return yield c.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}();if(e.files.galleryImage&&e.files.galleryImage.length<=3){var a,o=e.files.galleryImage;for(var l of o)a=yield t(l.path,i),yield n.create({galleryImage:a});e.flash("success","New images added to gallery!"),r.redirect("/admin/gallery")}else e.flash("error","Please choose images, but not more than 3"),r.redirect("back")}catch(i){d.error("From admin/gallery page:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.deletePhoto=function(){var e=s((function*(e,r){try{var i=yield n.findByIdAndDelete(e.params.img_id);yield c.cloudinary.uploader.destroy(i.galleryImage.id),e.flash("success","Image was delete from gallery"),r.redirect("back")}catch(r){d.error("From admin/gallery page:"+r.message),e.flash("error",r.message)}}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(69),a=i(12),{isLoggedIn:o}=i(6),c=i(1),{check:l}=i(3),d=[l("ourMission").notEmpty().withMessage("Our mission section is required").trim(),l("about").notEmpty().withMessage("Main about section is required").trim(),l("aboutSection1").trim(),l("aboutSection2").trim(),l("aboutSection2").trim()];s.route("/").get(o,c(n.showAbout)).post(o,a.upload.single("image"),d,c(n.createAbout)).put(o,a.upload.single("image"),d,c(n.updateAbout)),e.exports=s},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}function s(e){return function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))}}var n=i(14),a=i(7),o=i(8),c=i(16),{renderEJS:l}=i(5),{validationResult:d}=i(3),u=i(4);e.exports.showAbout=function(){var e=s((function*(e,r){var i=yield n.findOne({}),t=yield a.find({},"title template"),s=yield o.find({},"serviceTitle");yield l(r,"admin/about/about",{csrfToken:e.csrfToken(),cspNonce:r.locals.cspNonce,about:i,services:t,prices:s,title:"About",page:"about"})}));return function(r,i){return e.apply(this,arguments)}}();var m={transformation:[{width:550,height:750,crop:"fill"},{width:"auto",dpr:"auto",crop:"scale"}],fetch_format:"auto",quality:85,resource_type:"auto",folder:"Ilona"};e.exports.createAbout=function(){var e=s((function*(e,r){var i=d(e);i.isEmpty()||(i=i.array({onlyFirstError:!0}),e.flash("error",i[0].msg));try{var t=function(){var e=s((function*(e,r){return yield c.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}(),a=null;e.file&&(e.file.bytes>1e7&&e.flash("error","Please review size of images. 10Mb is maximum allowed"),a=yield t(e.file.path,m));var o={ourMission:e.body.ourMission,about:e.body.about,aboutSection1:e.body.aboutSection1,aboutSection2:e.body.aboutSection2,aboutSection3:e.body.aboutSection3,image:a};yield n.create(o),r.redirect("/admin/about")}catch(i){u.error("From admin/about page:"+i.message),e.flash("error",i.message),r.redirect("back")}}));return function(r,i){return e.apply(this,arguments)}}(),e.exports.updateAbout=function(){var e=s((function*(e,r){var i=yield n.findOne({}),t=function(){var e=s((function*(e,r){return yield c.uploads(e,r)}));return function(r,i){return e.apply(this,arguments)}}();e.file&&e.file.size<1e7?i.image.id?(yield c.cloudinary.uploader.destroy(i.image.id),i.image=yield t(e.file.path,m)):i.image=yield t(e.file.path,m):e.flash("error","Please review size of images. 10Mb is maximum allowed");var a=d(e);if(a.isEmpty())try{i.ourMission=e.body.ourMission,i.about=e.body.about,i.aboutSection1=e.body.aboutSection1,i.aboutSection2=e.body.aboutSection2,i.aboutSection3=e.body.aboutSection3,i.save(),e.flash("success","Information on About page was updated!"),r.redirect("/admin/about")}catch(r){u.error("From admin/about page:"+r.message),e.flash("error",r.message)}else a=a.array({onlyFirstError:!0}),e.flash("error",a[0].msg)}));return function(r,i){return e.apply(this,arguments)}}()},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(9),a=i(1);s.get("/",a(n.gallery)),e.exports=s},function(e,r,i){var{Router:t}=i(0),s=t(),n=i(9),a=i(1);s.get("/",a(n.about)),e.exports=s},function(e,r,i){var{Router:t}=i(0),s=t({mergeParams:!0}),n=i(73),a=i(1);s.get("/404",a(n.error)),e.exports=s},function(e,r,i){function t(e,r,i,t,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void i(e)}o.done?r(c):Promise.resolve(c).then(t,s)}var s=i(11),{renderEJS:n}=i(5);e.exports.error=function(){var e,r=(e=function*(e,r){var i=yield s.find({});yield n(r,"errors/404",{contacts:i,title:"404",cspNonce:r.locals.cspNonce})},function(){var r=this,i=arguments;return new Promise((function(s,n){var a=e.apply(r,i);function o(e){t(a,s,n,o,c,"next",e)}function c(e){t(a,s,n,o,c,"throw",e)}o(void 0)}))});return function(e,i){return r.apply(this,arguments)}}()}]);